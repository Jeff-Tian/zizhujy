$(document).ready(function(){var data=[[1900,10.83],[1904,11.48],[1908,12.17],[1912,12.96],[1920,13.42],[1924,12.96],[1928,13.77],[1932,14.15],[1936,14.27],[1948,14.1],[1952,14.92],[1956,14.96],[1960,15.42],[1964,16.73],[1968,17.71],[1972,18.04],[1976,18.04],[1980,18.96],[1984,18.85],[1988,19.77],[1992,19.02],[1996,19.42]];var $dataTableContainer=$('#data-area');$dataTableContainer.handsontable({minSpareRows:1,colHeaders:['x','y'],cols:2,rowHeaders:true,contextMenu:true,autoWrapRow:true,Controller:true});$dataTableContainer.handsontable('loadData',data);function isEmptyRow(instance,row){var rowData=instance.getData()[row];for(var i=0,ilen=rowData.length;i<ilen;i++){if(rowData[i]!==null){return false}}return true}function defaultValueRenderer(instance,td,row,col,prop,value,cellProperties){var args=$.extend(true,[],arguments);if(args[5]===null&&isEmptyRow(instance,row)){args[5]='';td.style.color='#999'}else{td.style.color=''}Handsontable.renderers.TextRenderer.apply(this,args)}var jPloter=null;var uiSettings={statsFormat:"",fitFormat:""};if(!window.console){window.console=new zizhujy.com.console("#log")}$("#btnPlot").click(btnPlotClicked);$("#btnClear").click(btnClearClicked);$("#btnEsitmateAndPredict").click(btnEsitmateAndPredictClicked);$("#chkLinearFit").change(chkLinearFitChanged);$("#chkQuadraticFit").change(chkQuadraticFitChanged);$("#chkCubicFit").change(chkCubicFitChanged);$("#chkExpFit").change(chkExpFitChanged);$("#chkLogFit").change(chkLogFitChanged);$("#chkPolynomialFit").change(chkPolynomialFitChanged);$("#txtPower").change(chkPolynomialFitChanged);$("#txtX").keyup(function(){updateFits()});$(window).resize(function(){});readUISettings();go(function(){$("#chkLinearFit").attr("checked","checked").trigger("change")});function btnPlotClicked(eventInfo){go();checkOptions()}function btnClearClicked(eventInfo){$('#data-area').handsontable('loadData',[[null,null]]);go()}function chkLinearFitChanged(eventInfo){if(jPloter!=null){var $chk=$(typeof(eventInfo.srcElement)!="undefined"?eventInfo.srcElement:eventInfo.target);if($chk.attr("checked")=="checked"){jPloter.addLinearModel()}else{jPloter.delLinearModel()}updateUI()}}function chkQuadraticFitChanged(eventInfo){if(jPloter!=null){var $chk=$(typeof(eventInfo.srcElement)!="undefined"?eventInfo.srcElement:eventInfo.target);if($chk.attr("checked")=="checked"){jPloter.addQuadraticModel()}else{jPloter.delQuadraticalModel()}updateUI()}}function chkCubicFitChanged(eventInfo){if(jPloter!=null){var $chk=$(typeof(eventInfo.srcElement)!="undefined"?eventInfo.srcElement:eventInfo.target);if($chk.attr("checked")=="checked"){jPloter.addCubicalModel()}else{jPloter.delCubicalModel()}updateUI()}}function chkExpFitChanged(eventInfo){if(jPloter!=null){var $chk=$(typeof(eventInfo.srcElement)!="undefined"?eventInfo.srcElement:eventInfo.target);if($chk.attr("checked")=="checked"){jPloter.addExponentialModel()}else{jPloter.delExponentialModel()}updateUI()}}function chkLogFitChanged(eventInfo){if(jPloter!=null){var $chk=$(typeof(eventInfo.srcElement)!="undefined"?eventInfo.srcElement:eventInfo.target);if($chk.attr("checked")=="checked"){jPloter.addLogarithmModel()}else{jPloter.delLogarithmModel()}updateUI()}}function chkPolynomialFitChanged(eventInfo){if(jPloter!=null){var $chk=$("#chkPolynomialFit");if($chk.prop("checked")){var $txtPower=$("#txtPower");var power=parseInt($txtPower.val());if(power>5){power=5;$txtPower.val(power)}if(power<1){power=1;$txtPower.val(power)}jPloter.delPolynomialModel();jPloter.addPolynomialModel(power)}else{jPloter.delPolynomialModel()}updateUI()}}function btnEsitmateAndPredictClicked(eventInfo){updateFits()}function updateStats(){if(jPloter!=null){var $statsArea=$("#statsColumn");$statsArea.html(jPloter.getStatistics(uiSettings.statsFormat))}}function updateFits(){if(jPloter!=null){var $models=$("#fits table tbody");$models.html("");var x=$("#txtX").val();var html=new StringBuffer;for(var modelIndex in jPloter.models){var model=jPloter.models[modelIndex];if(x!=""){x=parseFloat(x);var y="";try{y=window.eval("var x = "+x+";"+model.getExpression())}catch(ex){}html.append(uiSettings.fitFormat.format(model.name,model.formulaHtml,model.getParametersHtml(),model.sse.toFixed(2),x,y))}else{html.append(uiSettings.fitFormat.format(model.name,model.formulaHtml,model.getParametersHtml(),model.sse.toFixed(2),"",""))}}$models.html(html.toString())}}function updateCharts(){if(jPloter!=null){jPloter.draw($("#canvas"))}}function updateErrorMessage(){if(jPloter!=null&&jPloter.messages!=null&&jPloter.messages.length>0){var msgHtml="";var msgFormat=Globalize.localize("message.format");var msgItemFormat="<li>{0}</li>";for(var i=0;i<jPloter.messages.length;i++){msgHtml+=String.format(msgItemFormat,jPloter.messages[i])}msgHtml=String.format(msgFormat,msgHtml,$("#data-area").val());$(".mask").show();$("#data-area").addClass("errorBox");$("#error-message").html(msgHtml);$("#error-message").dialog({modal:true,minWidth:500})}else{$(".mask").hide();$("#data-area").removeClass("errorBox");$("#error-message").dialog({modal:true});$("#error-message").dialog("close");$("#error-message").html("")}}function updateUI(){updateStats();updateFits();updateCharts();updateErrorMessage()}function readUISettings(){uiSettings.statsFormat=$("#statsColumn").html();uiSettings.fitFormat=$("#fits table tbody").html()}function go(callback){jPloter=new JPloter;var s=$("#data-area").handsontable('getData');s=s.filter(function(row){var empty=true;for(var i=0;i<row.length;i++){if(row[i]!==null&&row[i]!==''){empty=false;break}}return!empty});if(s){jPloter.readDataPoints(s);updateUI();if(typeof callback==='function'){callback()}}else{alert(Globalize.localize("message.no.data"))}}function checkOptions(){var checkList=["#chkLinearFit","#chkQuadraticFit","#chkCubicFit","#chkExpFit","#chkLogFit","#chkPolynomialFit"];checkOne();function checkOne(){if(checkList.length>0){$(checkList[0]).trigger("change");checkList.splice(0,1);setTimeout(checkOne,5)}}}})